<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('head.ejs') %>
        <meta charset="utf-8">
        <title>Account Settings</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Include Bootstrap and jQuery libraries -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <link rel="icon" href="/images/keeppley_logo.webp" type="image/x-icon">
        <link href="/style/bootstrap_4.5.0.css" rel="stylesheet">

        <style>
            /* Styling goes here */
        </style>
</head>

<body>
    <!-- Header Section -->
    <header>
        <%- include('header_home_en.ejs') %>
    </header>

    <div style="margin-top:20px" class="container light-style flex-grow-1 container-p-y">
        <h4 class="font-weight-bold py-3 mb-4">
            Account settings
        </h4>
        <div class="card overflow-hidden">
            <div class="row no-gutters row-bordered row-border-light">
                <div class="col-md-3 pt-0">
                    <div class="list-group list-group-flush account-settings-links">
                        <a class="list-group-item list-group-item-action active" href="/General">General</a>
                        <a class="list-group-item list-group-item-action" href="/Avatar">Avatar</a>
                        <a class="list-group-item list-group-item-action " href="/Password">Change
                            password</a>
                        <a class="list-group-item list-group-item-action" href="/Information">Information</a>
                        <a class="list-group-item list-group-item-action" href="/SocialLinks">Social links</a>
                        <a class="list-group-item list-group-item-action" href="/Connections">Connections</a>
                        <a class="list-group-item list-group-item-action" href="/Notifications">Notifications</a>
                        <a class="list-group-item list-group-item-action" href="/Languages">Languages</a>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="account-info">
                            <form id="updateInformationForm" method="post">
                                <div class="card-body pb-2">
                                    <% if (success_message) { %>
                                        <div class="alert alert-success">
                                            <%= success_message %>
                                        </div>
                                        <% } %>
                                            <div class="form-group">
                                                <label class="form-label">Bio</label>
                                                <textarea class="form-control" name="bio"
                                                    rows="5"><%= userLogin.bio %></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Birthday</label>
                                                <input type="date" class="form-control" name="birthday" id="birthday"
                                                    value="<%= userLogin.birthday %>">
                                                <input type="hidden" name="userID" value="<%= userLogin.userID %>">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Country</label>
                                                <select class="custom-select" name="country">
                                                    <% countryList.forEach(country=> { %>
                                                        <option value="<%= country %>" <%=userLogin.country===country
                                                            ? 'selected' : '' %>><%= country %>
                                                        </option>
                                                        <% }); %>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Phone</label>
                                                <input type="text" class="form-control" name="phone"
                                                    value="<%= userLogin.phone %>">
                                            </div>
                                </div>
                                <div class="text-right mt-3">
                                    <button type="submit" class="btn btn-primary btn-setting">Save changes</button>
                                    <button type="button" class="btn btn-default btn-cancel btn-setting"
                                        id="cancelButton">Cancel</button>
                                    <a href="/logout" class="btn btn-danger btn-setting">Logout</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer id="footer-section">
        <%- include('footer.ejs') %>
    </footer>

    <!-- Cart Section -->
    <%- include('cart.ejs') %>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        <script src="/js/information.js"></script>
        <script>
            $(document).ready(function () {
                $('#birthday').datepicker({
                    dateFormat: "MM d, yy",
                    changeMonth: true,
                    changeYear: true,
                    yearRange: "1900:2100",
                    autoclose: true
                });

                // Submit form event
                $('#updateInformationForm').on('submit', function (e) {
                    e.preventDefault(); // Ngăn việc submit mặc định

                    $.ajax({
                        type: 'POST',
                        url: '/update-information', // Đường dẫn đến route cập nhật thông tin
                        data: $(this).serialize(),
                        success: function (response) {
                            // Hiển thị thông báo thành công
                            alert('Changes saved successfully');
                            location.reload(); // Reload lại trang sau khi cập nhật thành công
                        },
                        error: function (err) {
                            // Hiển thị lỗi nếu có
                            console.error(err);
                            alert('Error updating information');
                        }
                    });
                });

                $('#cancelButton').on('click', function () {
                    window.location.href = '/'; // Quay lại trang chủ khi nhấn Cancel
                });
            });

        </script>
        
    
    <script>
        const countryList = JSON.stringify(countryList)
    </script>
    
</body>

</html>